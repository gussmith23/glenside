<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Exception handling and stack unwinding for x64."><meta name="keywords" content="rust, rustlang, rust-lang, exception"><title>goblin::pe::exception - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><script defer src="../../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a class="sidebar-logo" href="../../../goblin/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.png" alt="logo"></div>
        </a><h2 class="location">Module exception</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></div><div id="sidebar-vars" data-name="exception" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../goblin/index.html"><img class="rust-logo" src="../../../rust-logo.png" alt="logo"></a><nav class="sub"><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">goblin</a>::<wbr><a href="../index.html">pe</a>::<wbr><a class="mod" href="#">exception</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/goblin/pe/exception.rs.html#1-1015" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Exception handling and stack unwinding for x64.</p>
<p>Exception information is exposed via the <a href="struct.ExceptionData.html"><code>ExceptionData</code></a> structure. If present in a PE file,
it contains a list of <a href="struct.RuntimeFunction.html"><code>RuntimeFunction</code></a> entries that can be used to get <a href="struct.UnwindInfo.html"><code>UnwindInfo</code></a> for a
particular code location.</p>
<p>Unwind information contains a list of unwind codes which specify the operations that are
necessary to restore registers (including the stack pointer RSP) when unwinding out of a
function.</p>
<p>Depending on where the instruction pointer lies, there are three strategies to unwind:</p>
<ol>
<li>
<p>If the RIP is within an epilog, then control is leaving the function, there can be no
exception handler associated with this exception for this function, and the effects of the
epilog must be continued to compute the context of the caller function. To determine if the
RIP is within an epilog, the code stream from RIP on is examined. If that code stream can be
matched to the trailing portion of a legitimate epilog, then it’s in an epilog, and the
remaining portion of the epilog is simulated, with the context record updated as each
instruction is processed. After this, step 1 is repeated.</p>
</li>
<li>
<p>Case b) If the RIP lies within the prologue, then control has not entered the function,
there can be no exception handler associated with this exception for this function, and the
effects of the prolog must be undone to compute the context of the caller function. The RIP
is within the prolog if the distance from the function start to the RIP is less than or
equal to the prolog size encoded in the unwind info. The effects of the prolog are unwound
by scanning forward through the unwind codes array for the first entry with an offset less
than or equal to the offset of the RIP from the function start, then undoing the effect of
all remaining items in the unwind code array. Step 1 is then repeated.</p>
</li>
<li>
<p>If the RIP is not within a prolog or epilog and the function has an exception handler, then
the language-specific handler is called. The handler scans its data and calls filter
functions as appropriate. The language-specific handler can return that the exception was
handled or that the search is to be continued. It can also initiate an unwind directly.</p>
</li>
</ol>
<p>For more information, see <a href="https://docs.microsoft.com/en-us/cpp/build/exception-handling-x64?view=vs-2017">x64 exception handling</a>.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ExceptionData.html" title="goblin::pe::exception::ExceptionData struct">ExceptionData</a></div><div class="item-right docblock-short"><p>Exception handling and stack unwind information for functions in the image.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Register.html" title="goblin::pe::exception::Register struct">Register</a></div><div class="item-right docblock-short"><p>An x64 register used during unwinding.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RuntimeFunction.html" title="goblin::pe::exception::RuntimeFunction struct">RuntimeFunction</a></div><div class="item-right docblock-short"><p>An unwind entry for a range of a function.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RuntimeFunctionIterator.html" title="goblin::pe::exception::RuntimeFunctionIterator struct">RuntimeFunctionIterator</a></div><div class="item-right docblock-short"><p>Iterator over runtime function entries in <a href="struct.ExceptionData.html"><code>ExceptionData</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.UnwindCode.html" title="goblin::pe::exception::UnwindCode struct">UnwindCode</a></div><div class="item-right docblock-short"><p>An unwind operation that is executed at a particular place in the function prolog.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.UnwindCodeIterator.html" title="goblin::pe::exception::UnwindCodeIterator struct">UnwindCodeIterator</a></div><div class="item-right docblock-short"><p>An iterator over unwind codes for a function or part of a function, returned from
<a href="struct.UnwindInfo.html"><code>UnwindInfo</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.UnwindInfo.html" title="goblin::pe::exception::UnwindInfo struct">UnwindInfo</a></div><div class="item-right docblock-short"><p>Unwind information for a function or portion of a function.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.StackFrameOffset.html" title="goblin::pe::exception::StackFrameOffset enum">StackFrameOffset</a></div><div class="item-right docblock-short"><p>An unsigned offset to a value in the local stack frame.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.UnwindHandler.html" title="goblin::pe::exception::UnwindHandler enum">UnwindHandler</a></div><div class="item-right docblock-short"><p>A language-specific handler that is called as part of the search for an exception handler or as
part of an unwind.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.UnwindOperation.html" title="goblin::pe::exception::UnwindOperation enum">UnwindOperation</a></div><div class="item-right docblock-short"><p>An unwind operation corresponding to code in the function prolog.</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="goblin" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.59.0 (9d1b2106e 2022-02-23)" ></div>
</body></html>